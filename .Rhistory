library(fs)
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/
dir_ls(dir)
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/'
dir_ls(dir)
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado'
dir_ls(dir)
pm25 <- rast(files)
files <- dir_ls(dir)
pm25 <- rast(files)
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado'
files <- dir_ls(dir)
files
pm25 <- rast(files)
library(terra)
library(tmap)
library(fs)
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado'
files <- dir_ls(dir)
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado'
files <- dir_ls(dir)
pm25 <- rast(files)
pm25
tm_shape(pm25) +
tm_raster() +
tm_facets()
names(pm25)
names(pm25) <- month.name[1:7]
tm_shape(pm25) +
tm_raster() +
tm_facets()
library(shiny)
library(tmap)
library(leaflet)
library(terra)
library(fs)
library(bslib)
library(sf)
library(tidyverse)
library(highcharter)
tmap_mode('view')
meses <- c('Enero'=1, 'Febrero'=2, 'Marzo'=3, 'Abril'=4, 'Mayo'=5, 'Junio'=6, 'Julio'=7, 'Agosto'=8, 'Septiembre'=9, 'Octubre'=10, 'Noviembre'=11, 'Diciembre'=12)
chl_reg <- read_rds('data/procesada/geo_regiones_chile.rds')
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado_size_min'
files <- dir_ls(dir)
pm25 <- rast(files[1])
pm25
?tm_raster
tm_shape(pm25) +
tm_raster(
col.scale = tm_scale_intervals(
#style = 'fisher',
values = "-magma",
midpoint = NA),
col.legend = tm_legend("PM 2.5 (μg/m³)",
orientation = "portrait",
width = 60,
position = c('left','top'))
) +
tm_shape(chl_reg,name = 'Límites regiones') +
tm_polygons(fill_alpha = 0,col = 'white',lwd=1.5) +
tm_basemap("OpenStreetMap") +
tm_view(set_view = 5)
?tm_scale_intervals
tm_shape(pm25) +
tm_raster(
col.scale = tm_scale_intervals(
style = 'quantile',
values = "-magma",
midpoint = NA),
col.legend = tm_legend("PM 2.5 (μg/m³)",
orientation = "portrait",
width = 60,
position = c('left','top'))
) +
tm_shape(chl_reg,name = 'Límites regiones') +
tm_polygons(fill_alpha = 0,col = 'white',lwd=1.5) +
tm_basemap("OpenStreetMap") +
tm_view(set_view = 5)
library(shiny)
library(tmap)
library(leaflet)
library(terra)
library(fs)
library(bslib)
library(sf)
library(tidyverse)
library(highcharter)
tmap_mode('view')
meses <- c('Enero'=1, 'Febrero'=2, 'Marzo'=3, 'Abril'=4, 'Mayo'=5, 'Junio'=6, 'Julio'=7, 'Agosto'=8, 'Septiembre'=9, 'Octubre'=10, 'Noviembre'=11, 'Diciembre'=12)
chl_reg <- read_rds('data/procesada/geo_regiones_chile.rds')
ui <- page_sidebar(
sidebar = sidebar(
selectInput('mes', 'Seleccionar mes', meses),
highchartOutput("barplot")
),
card(
full_screen = TRUE,
tmapOutput("mapa", width="100%",height = 800)
)
server <- function(input,output, session){
# output$plot <- renderPlot({
#   hist(rnorm(100))
# })
output$mapa <- renderTmap({
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado_size_min'
files <- dir_ls(dir)
mes <- as.numeric(input$mes)
pm25 <- rast(files[mes])
#names(pm25) <- month.name[1:7]
tm_shape(pm25) +
tm_raster(
col.scale = tm_scale_intervals(
style = 'quantile',
values = "-magma",
midpoint = NA),
col.legend = tm_legend("PM 2.5 (μg/m³)",
orientation = "portrait",
width = 60,
position = c('left','top'))
) +
tm_shape(chl_reg,name = 'Límites regiones') +
tm_polygons(fill_alpha = 0,col = 'white',lwd=1.5) +
tm_basemap("OpenStreetMap") +
tm_view(set_view = 5)
})
output$barplot <- renderHighchart({
mes <- input$mes |> as.numeric()
data <- read_rds('data/procesada/datos_pm25_modelado_por_region.rds') |>
select(all_of(mes),region) |> set_names(c('PM25','region'))
hc <- hchart(object =data,
type = "bar",
hcaes(x = region, y =PM25),
color ='red',
name = 'PM 2.5') |>
hc_xAxis(title = list(text = NULL)) |>   # Remove x-axis title
hc_yAxis(title = list(text = "")) |>
hc_tooltip(
formatter = JS("function() {
return '<b>' + this.x + '</b><br/>' +
'Value: ' + Highcharts.numberFormat(this.y, 1, '.', ','); // Format with thousands separator and no decimals
}")
)
})
}
shinyApp(ui=ui, server=server)
chl_reg <- read_rds('data/procesada/geo_regiones_chile.rds')
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado'
files <- dir_ls(dir)
pm25 <- rast(files)
meses <- c('Enero'=1, 'Febrero'=2, 'Marzo'=3, 'Abril'=4, 'Mayo'=5, 'Junio'=6, 'Julio'=7, 'Agosto'=8, 'Septiembre'=9, 'Octubre'=10, 'Noviembre'=11, 'Diciembre'=12)
names(pm25) <- meses[1:nlyr(pm25)]
df_pm25_regs <- terra::extract(pm25,chl_reg,fun = 'mean',na.rm = TRUE)
data_plot <- df_pm25_regs |>
mutate(region =chl_reg$gn_name) |>
select(-ID) |>
as_tibble() |>
mutate(region =str_remove(region,'Regi(o|ó)n (de|del) '),
region =str_remove(region,'(Region |la )'))
write_rds(data_plot,'data/procesada/datos_pm25_modelado_por_region.rds')
library(shiny)
library(tmap)
library(leaflet)
library(terra)
library(fs)
library(bslib)
library(sf)
library(tidyverse)
library(highcharter)
tmap_mode('view')
meses <- c('Enero'=1, 'Febrero'=2, 'Marzo'=3, 'Abril'=4, 'Mayo'=5, 'Junio'=6, 'Julio'=7, 'Agosto'=8, 'Septiembre'=9, 'Octubre'=10, 'Noviembre'=11, 'Diciembre'=12)
chl_reg <- read_rds('data/procesada/geo_regiones_chile.rds')
ui <- page_sidebar(
sidebar = sidebar(
selectInput('mes', 'Seleccionar mes', meses),
highchartOutput("barplot")
),
card(
full_screen = TRUE,
tmapOutput("mapa", width="100%",height = 800)
)
server <- function(input,output, session){
# output$plot <- renderPlot({
#   hist(rnorm(100))
# })
output$mapa <- renderTmap({
dir <- '/mnt/data_procesada/papers/PM2.5_Chile/rasters/modelado_size_min'
files <- dir_ls(dir)
mes <- as.numeric(input$mes)
pm25 <- rast(files[mes])
#names(pm25) <- month.name[1:7]
tm_shape(pm25) +
tm_raster(
col.scale = tm_scale_intervals(
style = 'quantile',
values = "-magma",
midpoint = NA),
col.legend = tm_legend("PM 2.5 (μg/m³)",
orientation = "portrait",
width = 60,
position = c('left','top'))
) +
tm_shape(chl_reg,name = 'Límites regiones') +
tm_polygons(fill_alpha = 0,col = 'white',lwd=1.5) +
tm_basemap("OpenStreetMap") +
tm_view(set_view = 5)
})
output$barplot <- renderHighchart({
mes <- input$mes |> as.numeric()
data <- read_rds('data/procesada/datos_pm25_modelado_por_region.rds') |>
select(all_of(mes),region) |> set_names(c('PM25','region'))
hc <- hchart(object =data,
type = "bar",
hcaes(x = region, y =PM25),
color ='red',
name = 'PM 2.5') |>
hc_xAxis(title = list(text = NULL)) |>   # Remove x-axis title
hc_yAxis(title = list(text = "")) |>
hc_tooltip(
formatter = JS("function() {
return '<b>' + this.x + '</b><br/>' +
'Value: ' + Highcharts.numberFormat(this.y, 1, '.', ','); // Format with thousands separator and no decimals
}")
)
})
}
shinyApp(ui=ui, server=server)
